# Бизнес-требования (MVP «Заказ покупателя»)

Документ фиксирует требования к первому релизу (MVP) процесса заказа в Exolynk. Служит официальной точкой согласования и может использоваться как демонстрационный кейс.

## 1. Цели проекта
- Дать продажам единый инструмент для сопровождения заказа от создания до выдачи.
- Обеспечить прозрачность статусов для менеджера и логистики.
- Подготовить основу для дальнейшей автоматизации (интеграции, уведомления, отчёты).

## 2. Объём MVP
- Один тип заказа (B2B).
- Минимальный набор состояний и ролей (см. ниже).
- Прототип фронта и модель данных — ориентир для будущего внедрения.
- Интеграции и вложения (файлы) не входят в выпуск 1.

## 3. Роли и ответственность
| Роль | Ответственность | Исключения в MVP |
| --- | --- | --- |
| **Sales** | Создаёт заказ, редактирует позиции, переводит в `PICKING`, закрывает неуспешные сделки. | Нет расчётов скидок, нет общих прайс-листов. |
| **Manager** | Утверждает заказы >10 000 CHF, подтверждает оплату, завершает процесс. | Нет SLA, нет автоматической эскалации. |
| **Logistics** | Подтверждает комплектацию (`READY`), указывает дату отгрузки. | Нет интеграции с WMS. |
| **System** | Выполняет автоматические действия (уведомления, установка `shipment_state=SHIPPED`). | Реальные сервисы оповещений отключены. |

## 4. Пользовательские сценарии
1. Sales создаёт заказ (`NEW`), заполняет позиции, отправляет на подтверждение.
2. Manager утверждает (`APPROVAL → PICKING`) или отклоняет (возвращает в `NEW`).
3. Logistics переводит в `READY`, фиксирует дату отгрузки.
4. Manager подтверждает оплату (`payment_state=YES`), закрывает успешно (`CLOSED` + `closed_success=true`).
5. Sales может закрыть неуспешно (`CLOSED` + `closed_success=false`) с указанием причины.

## 5. Состояния и статусы
- `state`: `NEW`, `APPROVAL`, `PICKING`, `READY`, `CLOSED`.
- `status` (агрегированный): `OPEN`, `EXECUTION`, `CLOSED`.
- `shipment_state`: `PICKING`, `READY`, `SHIPPED`.
- `payment_state`: `NO`, `YES`.
- `close_reason`: `CUSTOMER_DECLINED`, `OUT_OF_STOCK`, `PRICE_OR_TERMS`, `DUPLICATE`, `OTHER`.

## 6. Требования к данным (кратко)
- `Order`: id, номер, клиент, суммы, состояние, даты, комментарий.
- `OrderItem`: id, ссылка на заказ, sku, название, количество, цена.
- `Contact`: используем существующий справочник платформы.
Полная структура описана в ERD (`diagrams/dbdiagram/customer_order_erd.txt`).

## 7. UI и UX
- Канбан + список заказов.
- Вкладка «Клиенты» с краткой информацией и связью с заказами.
- Детальная карточка заказа: основные атрибуты, позиции, история действий.
(Макет: `ui/exolynk_sales_workspace.html`).

## 8. Ограничения и допущения
- Рабочая модель проверяется в тестовом окружении Exolynk.
- Уведомления и интеграции описаны концептуально; реальная реализация за рамками MVP.
- Все документы ведутся на русском; к финальной демонстрации планируется перевод на английский.

## 9. Связанные документы
- `docs/process/process_sales_order.md` — детальный процесс.
- `docs/tech/tech_stack.md` — платформа, инструменты, интеграции.
- `docs/methodology/SPS-TP.md` — методологическая основа.

Документ обновляется по мере уточнения требований и служит отправной точкой для всех последующих артефактов.
